---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';
import { getCollection, type CollectionEntry } from 'astro:content';
import ProjectCard from '@components/ProjectCard/ProjectCard.astro';
import classes from './ProjectsSlider.module.css';
import ProjectsSliderPagination from './ProjectsSliderPagination.astro';
import ProjectsSliderNavigation from './ProjectsSliderNavigation.astro';
import ProjectsSliderScrollbar from './ProjectsSliderScrollbar.astro';

const projects: CollectionEntry<'project'>[] = (await getCollection('project')).sort(
  (a: CollectionEntry<'project'>, b: CollectionEntry<'project'>) =>
    b.data.createdDate.valueOf() - a.data.createdDate.valueOf(),
);

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/images/projects/preview/*',
);
---

<div class:list={[classes.projects, 'projects-slider']}>
  <ProjectsSliderPagination />
  <ProjectsSliderNavigation />
  <div class="swiper-wrapper">
    {
      projects.map((project) => (
        <div class:list={[classes.slide, 'swiper-slide']}>
          <div class:list={[classes.slide__wrapper, 'wrapper-inner']}>
            {/* Project image start */}
            <Image
              src={images[`/src/assets/images/projects/preview/${project.data.previewImage.src}`]()}
              alt={project.data.previewImage.alt}
              format="avif"
              widths={[380, 650]}
              quality={75}
              sizes={'(min-width: 460px) 650px, calc(100vw - 30px)'}
              class={classes.slide__img}
              width={650}
              height={488}
            />
            {/* Project image end */}
            <ProjectCard project={project} />
            <div class="swiper-lazy-preloader" />
          </div>
        </div>
      ))
    }
  </div>
  <ProjectsSliderScrollbar />
</div>

<script>
  import Swiper from 'swiper';
  import { A11y, Keyboard, Navigation, Pagination, Scrollbar } from 'swiper/modules';
  import 'swiper/css';
  import 'swiper/css/scrollbar';
  import 'swiper/css/navigation';

  const projectsSlider = document.querySelector('.projects-slider') as HTMLDivElement;

  const slider = new Swiper(projectsSlider, {
    modules: [Navigation, Pagination, Keyboard, Scrollbar, A11y],
    direction: 'vertical',
    loop: false,
    speed: 1000,
    slidesPerView: 'auto',
    grabCursor: true,
    // Enable keyboard navigation
    keyboard: {
      enabled: true,
      onlyInViewport: true,
      pageUpDown: true,
    },
    // Slider navigation buttons with arrows
    navigation: {
      nextEl: '.next-slide',
      prevEl: '.prev-slide',
      disabledClass: 'slider-btn-disabled',
    },
    // Slider scrollbar
    scrollbar: {
      el: '.swiper-scrollbar',
      draggable: true,
    },
    // Custom pagination with numbers
    pagination: {
      el: '.total-slides',
      type: 'custom',
      // Render total slides
      renderCustom: function (swiper, current, total) {
        return `0${total}`;
      },
    },
    breakpoints: {
      // From 0px and above set slider direction to horizontal and hide scrollbar
      0: {
        direction: 'horizontal',
        scrollbar: {
          enabled: false,
        },
      },
      // From 1060px and above set slider direction to vertical and show scrollbar
      1060: {
        direction: 'vertical',
        scrollbar: {
          enabled: true,
        },
      },
    },
  });
</script>
